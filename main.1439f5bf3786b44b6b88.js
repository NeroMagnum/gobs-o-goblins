!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=0)}([function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var Char={WHITE_SMILING_FACE:"☺",BLACK_SMILING_FACE:"☻",BLACK_HEART_SUIT:"♥",BLACK_DIAMOND_SUIT:"♦",BLACK_CLUB_SUIT:"♣",BLACK_SPADE_SUIT:"♠",BULLET:"•",INVERSE_BULLET:"◘",WHITE_CIRCLE:"○",INVERSE_WHITE_CIRCLE:"◙",MALE_SIGN:"♂",FEMALE_SIGN:"♀",EIGHTH_NOTE:"♪",BEAMED_EIGHTH_NOTES:"♫",WHITE_SUN_WITH_RAYS:"☼",NULL:" ",SPACE:" ",AMPERSAND:"&",DOT:".",FULL_STOP:".",PLUS:"+",MINUS:"-",HASH:"#",DOLLAR:"$",PERCENT:"%",CARET:"^",ASTERISK:"*",TILDE:"~",LEFT_PARENS:"(",RIGHT_PARENS:")",LEFT_BRACKET:"[",RIGHT_BRACKET:"]",AT:"@"},overprint_char=Char,font=function(family,weight,size){return{family:family||"monospace",weight:weight||"normal",size:size||16,toCSS:function(){return this.weight+" "+this.size+"px "+this.family}}},color={BLACK:"#000",WHITE:"#fff"},cell_Cell=function(character,foregroundColor,backgroundColor){return{character:character||overprint_char.NULL,foregroundColor:foregroundColor||color.WHITE,backgroundColor:backgroundColor||color.BLACK}};cell_Cell.blank=function(backgroundColor){return cell_Cell(!1,!1,backgroundColor)};var overprint_cell=cell_Cell;function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function fillArray2D(width,height,fill){for(var list=new Array(width),col=0;col<width;col++){list[col]=new Array(height);for(var row=0;row<height;row++)list[col][row]=fill}return list}var display_state=function(){function DisplayState(width,height){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DisplayState),this._width=width,this._height=height,this._renderedCells=fillArray2D(width,height,null),this._updatedCells=fillArray2D(width,height,null),this._dirty=!0}var Constructor,protoProps,staticProps;return Constructor=DisplayState,(protoProps=[{key:"setCharacter",value:function(x,y,character){if(!(x<0)&&!(x>=this._width)&&!(y<0)&&!(y>=this._height)&&character)if(this._renderedCells[x][y].character!=character){var foregroundColor=this._updatedCells[x][y].foregroundColor||this._renderedCells[x][y].foregroundColor,backgroundColor=this._updatedCells[x][y].backgroundColor||this._renderedCells[x][y].backgroundColor;this._updatedCells[x][y]={character:character,foregroundColor:foregroundColor,backgroundColor:backgroundColor},this._dirty=!0}else this._updatedCells[x][y]=null}},{key:"setCell",value:function(x,y,cell){x<0||x>=this._width||y<0||y>=this._height||null!=cell&&(null==this._renderedCells[x][y]||this._renderedCells[x][y].character!=cell.character||this._renderedCells[x][y].foregroundColor!=cell.foregroundColor||this._renderedCells[x][y].backgroundColor!=cell.backgroundColor?(this._updatedCells[x][y]=cell,this._dirty=!0):this._updatedCells[x][y]=null)}},{key:"getCell",value:function(x,y){if(!(x<0||x>=this._width||y<0||y>=this._height))return this._updatedCells[x][y]||this._renderedCells[x][y]}},{key:"render",value:function(callback){if(this._dirty)for(var cell,col=0;col<this._width;col++)for(var row=0;row<this._height;row++)null!=(cell=this._updatedCells[col][row])&&(callback(col,row,cell),this._renderedCells[col][row]=cell,this._updatedCells[col][row]=null)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),DisplayState}();function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function text_grid_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var defaultSettings={width:40,height:30,font:font(),emptyCell:overprint_cell(),isResponsive:!1,forceSquare:!0},text_grid=function(){function TextGrid(canvas,settings){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TextGrid);var _settings=Object.assign(defaultSettings,function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({},settings));this._width=_settings.width,this._height=_settings.height,this._font=_settings.font,this._responsive=_settings.isResponsive,this._squared=_settings.forceSquare,this._emptyCell=_settings.emptyCell,this._glyphCache=new Map,this._canvas=canvas,this._context=this._canvas.getContext("2d",{willReadFrequently:!0}),this._context.font=this._font.toCSS(),this._ratio=window.devicePixelRatio||1,this._display=new display_state(this._width,this._height),this.resetLayout(),this.clear()}var Constructor,protoProps,staticProps;return Constructor=TextGrid,(protoProps=[{key:"resetLayout",value:function(){if(this._responsive){this._canvas.style.width||(this._canvas.style.width=640),this._canvas.style.height||(this._canvas.style.height=480);var elementWidth=parseInt(this._canvas.style.width,10)*this._ratio,elementHeight=parseInt(this._canvas.style.height,10)*this._ratio;this._cellWidth=Math.floor(elementWidth/this._width),this._cellHeight=Math.floor(elementHeight/this._height),this._squared&&(this._cellWidth=this._cellHeight=Math.max(this._cellWidth,this._cellHeight)),this._canvas.width=elementWidth,this._canvas.height=elementHeight}else{var textMeasure=this._context.measureText("M"),textWidth=Math.ceil(textMeasure.width),textHeight=this._font.size;this._squared&&(textWidth=textHeight=Math.max(textWidth,textHeight)),this._cellWidth=Math.ceil(textWidth*this._ratio),this._cellHeight=Math.ceil(textHeight*this._ratio);var drawWidth=textWidth*this._width,drawHeight=textHeight*this._height;this._canvas.width=drawWidth*this._ratio,this._canvas.height=drawHeight*this._ratio,this._canvas.style.width="".concat(drawWidth,"px"),this._canvas.style.height="".concat(drawHeight,"px")}this._font.size=this._font.size*this._ratio,this._context.font=this._font.toCSS(),this._context.textAlign="center",this._context.textBaseline="middle",this._cellCache=new Map}},{key:"clear",value:function(){this.fill(this._emptyCell)}},{key:"fill",value:function(cell){for(var col=0;col<this._width;col++)for(var row=0;row<this._height;row++)this._display.setCell(col,row,cell)}},{key:"readCell",value:function(x,y){return this._display.getCell(x,y)}},{key:"writeCell",value:function(x,y,cell){this._display.setCell(x,y,cell)}},{key:"writeCharacter",value:function(x,y,character){this._display.setCharacter(x,y,character)}},{key:"render",value:function(){var _this=this;this._display.render((function(x,y,cell){var cellWidth=_this._cellWidth,cellHeight=_this._cellHeight,blitKey="".concat(cell.character,";").concat(cell.foregroundColor,";").concat(cell.backgroundColor);if(_this._cellCache.has(blitKey))_this._context.putImageData(_this._cellCache.get(blitKey),x*cellWidth,y*cellHeight);else{if(_this._context.fillStyle=cell.backgroundColor,_this._context.fillRect(x*cellWidth,y*cellHeight,cellWidth,cellHeight),cell.character==overprint_char.NULL)return;_this._context.fillStyle=cell.foregroundColor;var xPos=x*cellWidth+cellWidth/2,yPos=y*cellHeight+cellHeight/2;_this._context.fillText(cell.character,Math.round(xPos),Math.round(yPos));var blitCell=_this._context.getImageData(x*cellWidth,y*cellHeight,cellWidth,cellHeight);_this._cellCache.set(blitKey,blitCell)}}))}},{key:"pxToCell",value:function(ev){var bounds=this._canvas.getBoundingClientRect(),relativeX=ev.clientX-bounds.left,relativeY=ev.clientY-bounds.top;return[Math.trunc(relativeX/this._cellWidth*this._ratio),Math.trunc(relativeY/this._cellHeight*this._ratio)]}},{key:"onClick",value:function(handler){var _this2=this;this._canvas.addEventListener("click",(function(ev){var cell=_this2.pxToCell(ev);handler(cell[0],cell[1])}))}},{key:"onMouseMove",value:function(handler){var _this3=this;this._canvas.addEventListener("mousemove",(function(ev){var cell=_this3.pxToCell(ev);handler(cell[0],cell[1])}))}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}])&&text_grid_defineProperties(Constructor.prototype,protoProps),staticProps&&text_grid_defineProperties(Constructor,staticProps),TextGrid}();console.log("Hello World!");var grid=new text_grid(document.querySelector("#game"),{width:80,height:50,font:font("Menlo",!1,15)});grid.render(),grid.writeCell(40,25,overprint_cell("@","rgba(242, 0, 255, 0.82)"));var action,player={x:Math.floor(40),y:Math.floor(25)};grid.writeCell(player.x,player.y,overprint_cell("@")),grid.render(),document.addEventListener("keydown",(function(ev){return function(key){switch(key){case"ArrowUp":action={x:0,y:-1};break;case"ArrowDown":action={x:0,y:1};break;case"ArrowLeft":action={x:-1,y:0};break;case"ArrowRight":action={x:1,y:0}}console.log(action),console.log(player)}(ev.key)})),requestAnimationFrame((function gameLoop(){action&&(player.x=Math.min(77,Math.max(0,player.x+action.x)),player.y=Math.min(48,Math.max(0,player.y+action.y))),action=null,grid.clear(),grid.writeCell(player.x,player.y,overprint_cell("@")),grid.render(),requestAnimationFrame(gameLoop)}))}]);
//# sourceMappingURL=main.1439f5bf3786b44b6b88.js.map